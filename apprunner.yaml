version: 1.0
runtime: nodejs20
build:
  commands:
    pre-build:
      - npm ci
      - npm ci --prefix backend
    build:
      - npm run build
      - npm run build --prefix backend
      - mkdir -p backend/dist/public && cp -r dist/* backend/dist/public/
run:
  command: node backend/dist/server.js
  network:
    port: 8080
    env: PORT
  env:
    - name: NODE_ENV
      value: production
